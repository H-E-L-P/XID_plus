

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Empirical modelling of data &mdash; XID+ 2.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> XID+
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../philosophy.html">A Generative Probabilistic Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html#docker">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hpc.html">Large Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../priors.html">Beyond Positional Priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">XID+</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Empirical modelling of data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/notebooks/examples/.ipynb_checkpoints/Empirical_test-checkpoint.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Empirical-modelling-of-data">
<h1>Empirical modelling of data<a class="headerlink" href="#Empirical-modelling-of-data" title="Permalink to this headline">Â¶</a></h1>
<p>Here I will test modelling the multiband data as part of an empirical prior model. To illustrate and validate this I will carry out the following steps: 1. Model simulation distribution 2. Model simulation distribution having made cut 3. Model simulation distribution with model for cuts 3. Model simulation distribution from map</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mock</span><span class="o">=</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;../../../test_files/lacey_07012015_MillGas.ALLVOLS_cat_PSW_COSMOS_test.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mock</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
&lt;Table length=10&gt;
<table id="table4367992032" class="table-striped table-bordered table-condensed">
<thead><tr><th>DHALOID</th><th>GALAXYID</th><th>S100</th><th>S160</th><th>S250</th><th>S350</th><th>S500</th><th>APPUSO_TOT_EXT</th><th>APPGSO_TOT_EXT</th><th>APPRSO_TOT_EXT</th><th>APPISO_TOT_EXT</th><th>APPZSO_TOT_EXT</th><th>DEC</th><th>IS_CENTRAL</th><th>MHHALO</th><th>MSTARDOT</th><th>MSTARS_TOT</th><th>RA</th><th>Z_COS</th><th>Z_OBS</th></tr></thead>
<thead><tr><th>str22</th><th>str22</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float64</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float64</th><th>float32</th><th>float32</th></tr></thead>
<tr><td>7221000005</td><td>250660000005</td><td>0.184557</td><td>0.847295</td><td>1.00324</td><td>0.666443</td><td>0.30983</td><td>21.0851</td><td>19.9199</td><td>19.3745</td><td>19.1446</td><td>18.9669</td><td>2.52281435887</td><td>0.0</td><td>1.12367e+11</td><td>8.41508e+07</td><td>1.02091e+09</td><td>149.968831368</td><td>0.102633</td><td>0.100918</td></tr>
<tr><td>7354000005</td><td>252230000005</td><td>0.879098</td><td>2.2013</td><td>1.80466</td><td>0.997061</td><td>0.40618</td><td>20.3638</td><td>19.3247</td><td>18.8853</td><td>18.698</td><td>18.5506</td><td>1.09296587368</td><td>0.0</td><td>1.81679e+11</td><td>1.88512e+08</td><td>1.15188e+09</td><td>149.996199092</td><td>0.092121</td><td>0.0912445</td></tr>
<tr><td>4026000013</td><td>210160000013</td><td>0.0112136</td><td>0.0411177</td><td>0.0405248</td><td>0.0241011</td><td>0.0102681</td><td>25.039</td><td>23.1625</td><td>21.7082</td><td>21.1741</td><td>20.85</td><td>2.10696062174</td><td>0.0</td><td>2.84672e+11</td><td>2.00169e+06</td><td>6.09953e+09</td><td>149.137297107</td><td>0.376282</td><td>0.376532</td></tr>
<tr><td>4726000013</td><td>219730000013</td><td>0.0652038</td><td>0.208996</td><td>0.191553</td><td>0.110243</td><td>0.0459506</td><td>23.3759</td><td>22.8123</td><td>21.79</td><td>21.5169</td><td>21.3217</td><td>2.56423522875</td><td>0.0</td><td>2.80937e+11</td><td>3.34448e+08</td><td>1.60865e+09</td><td>150.92582623</td><td>0.376829</td><td>0.377374</td></tr>
<tr><td>5536000013</td><td>230270000013</td><td>0.103659</td><td>0.455567</td><td>0.496569</td><td>0.309403</td><td>0.13604</td><td>22.8201</td><td>22.3489</td><td>21.3669</td><td>21.1046</td><td>20.9246</td><td>2.16826441305</td><td>0.0</td><td>1.81664e+11</td><td>5.8204e+08</td><td>2.28481e+09</td><td>149.524681469</td><td>0.377186</td><td>0.377635</td></tr>
<tr><td>5762000013</td><td>233190000013</td><td>0.136709</td><td>0.615261</td><td>0.677913</td><td>0.424214</td><td>0.187012</td><td>22.8012</td><td>22.2651</td><td>21.2245</td><td>20.9151</td><td>20.6908</td><td>1.88389672817</td><td>0.0</td><td>1.76046e+11</td><td>6.97228e+08</td><td>3.16073e+09</td><td>149.729887985</td><td>0.383715</td><td>0.3851</td></tr>
<tr><td>9150000013</td><td>272530000013</td><td>0.0201797</td><td>0.105251</td><td>0.130986</td><td>0.0878964</td><td>0.0408579</td><td>23.9817</td><td>23.5002</td><td>22.5123</td><td>22.2561</td><td>22.0729</td><td>2.41002832928</td><td>0.0</td><td>8.80211e+10</td><td>1.92794e+08</td><td>7.69563e+08</td><td>149.891553543</td><td>0.381552</td><td>0.382695</td></tr>
<tr><td>4424000012</td><td>215640000012</td><td>0.0270184</td><td>0.146568</td><td>0.192646</td><td>0.136105</td><td>0.0665875</td><td>23.3157</td><td>22.8147</td><td>22.039</td><td>21.8566</td><td>21.7233</td><td>1.40785718228</td><td>0.0</td><td>1.55454e+11</td><td>2.51134e+08</td><td>6.29514e+08</td><td>150.436258903</td><td>0.327132</td><td>0.325931</td></tr>
<tr><td>24026571</td><td>1840000011</td><td>39.481</td><td>67.4472</td><td>45.2025</td><td>23.0549</td><td>8.96614</td><td>23.275</td><td>21.9669</td><td>20.7596</td><td>20.2263</td><td>19.9311</td><td>2.15883520338</td><td>0.0</td><td>2.30369e+11</td><td>5.59299e+09</td><td>2.42265e+10</td><td>149.563597856</td><td>0.292259</td><td>0.293412</td></tr>
<tr><td>24026509</td><td>1850000011</td><td>0.4366</td><td>1.29728</td><td>1.12227</td><td>0.626028</td><td>0.255027</td><td>21.9426</td><td>21.1694</td><td>20.2875</td><td>19.9949</td><td>19.8004</td><td>2.02323895883</td><td>0.0</td><td>2.43463e+11</td><td>7.10691e+08</td><td>3.93756e+09</td><td>149.438586031</td><td>0.292881</td><td>0.292721</td></tr>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pystan</span>
</pre></div>
</div>
</div>
<div class="section" id="Gaussian-Mixture-model">
<h2>Gaussian Mixture model<a class="headerlink" href="#Gaussian-Mixture-model" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">data {</span>
<span class="s2">  int N;</span>
<span class="s2">  int D;</span>
<span class="s2">  vector[D] y[N];</span>
<span class="s2">  int n_groups;</span>
<span class="s2">}</span>
<span class="s2">parameters {</span>
<span class="s2">  ordered[n_groups] mu_S250;</span>
<span class="s2">  vector[D-1] mu_other[n_groups];</span>
<span class="s2">  cholesky_factor_corr[D] L[n_groups];</span>
<span class="s2">  simplex[n_groups] Theta;</span>
<span class="s2">  vector&lt;lower=0&gt;[D] L_sigma[n_groups];</span>

<span class="s2">}</span>
<span class="s2">transformed parameters {</span>
<span class="s2">  vector[D] mu_all[n_groups];</span>
<span class="s2">  for (n in 1:n_groups){</span>
<span class="s2">  mu_all[n,1]=mu_S250[n];</span>
<span class="s2">  for (d in 1:D-1){</span>
<span class="s2">  mu_all[n,d+1]=mu_other[n,d];</span>
<span class="s2">  }</span>
<span class="s2">  }</span>






<span class="s2">}</span>
<span class="s2">model {</span>
<span class="s2">  vector[n_groups] contributions;</span>
<span class="s2">  matrix[D, D] L_Sigma[n_groups];</span>
<span class="s2">  // priors</span>
<span class="s2">  mu_S250~normal(0, 10);</span>

<span class="s2">  Theta ~ dirichlet(rep_vector(2.0, n_groups));</span>
<span class="s2">  for(n in 1:n_groups) {</span>
<span class="s2">  L[n] ~ lkj_corr_cholesky(4);</span>
<span class="s2">  L_sigma[n] ~ cauchy(0, 2.5);</span>
<span class="s2">  L_Sigma[n] = diag_pre_multiply(L_sigma[n], L[n]);</span>
<span class="s2">  for (i in 1:D-1){</span>
<span class="s2">  mu_other[n,i] ~ normal(0, 10);</span>
<span class="s2">  }</span>
<span class="s2">  }</span>
<span class="s2">  // likelihood</span>
<span class="s2">  for(i in 1:N) {</span>
<span class="s2">    for(k in 1:n_groups) {</span>

<span class="s2">      contributions[k] = log(Theta[k]) + multi_normal_cholesky_lpdf(y[i] | mu_all[k], L_Sigma[k]);</span>
<span class="s2">    }</span>
<span class="s2">    target += log_sum_exp(contributions);</span>
<span class="s2">  }</span>
<span class="s2">}</span>
<span class="s2">generated quantities {</span>
<span class="s2">vector[D] yrep[2];</span>
<span class="s2">matrix[D, D] L_Sigma[n_groups];</span>
<span class="s2">L_Sigma[1] = diag_pre_multiply(L_sigma[1], L[1]);</span>
<span class="s2">for(i in 1:2){</span>
<span class="s2">yrep[i]=multi_normal_cholesky_rng(mu_all[1], L_Sigma[1]);</span>
<span class="s2">}</span>


<span class="s2">}</span>


<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[131]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">pystan</span><span class="o">.</span><span class="n">StanModel</span><span class="p">(</span><span class="n">model_code</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:pystan:COMPILING THE C++ CODE FOR MODEL anon_model_e64f93d11b43efeb41e87e72a51be1f9 NOW.
</pre></div></div>
</div>
</div>
<div class="section" id="Select-sources-that-have-finite-flux-values-in-100,-250,-350-and-500-\mathrm{\mu-m}">
<h2>Select sources that have finite flux values in 100, 250, 350 and 500 <span class="math notranslate nohighlight">\(\mathrm{\mu m}\)</span><a class="headerlink" href="#Select-sources-that-have-finite-flux-values-in-100,-250,-350-and-500-\mathrm{\mu-m}" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[172]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ind_true</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S100&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S250&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S350&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S500&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/ipykernel/__main__.py:1: RuntimeWarning: divide by zero encountered in log10
  if __name__ == &#39;__main__&#39;:
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[173]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_true</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S100&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind_true</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S250&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind_true</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S350&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind_true</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S500&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind_true</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/ipykernel/__main__.py:1: RuntimeWarning: divide by zero encountered in log10
  if __name__ == &#39;__main__&#39;:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[168]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="n">ind_true</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
      <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y_true</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
      <span class="s1">&#39;n_groups&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[152]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">sampling</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[153]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[153]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference for Stan model: anon_model_e64f93d11b43efeb41e87e72a51be1f9.
4 chains, each with iter=2000; warmup=1000; thin=1;
post-warmup draws per chain=1000, total post-warmup draws=4000.

                 mean se_mean     sd   2.5%    25%    50%    75%  97.5%  n_eff   Rhat
mu_S250[0]      -1.79    0.01   0.11  -2.03  -1.86  -1.79  -1.72  -1.59     97   1.03
mu_other[0,0]   -1.16  8.8e-3   0.08  -1.32  -1.21  -1.15   -1.1   -1.0     85   1.03
mu_other[0,1]   -1.35  8.4e-3   0.08  -1.52   -1.4  -1.35   -1.3  -1.21     86   1.03
mu_other[0,2]    -1.7  8.1e-3   0.08  -1.86  -1.75   -1.7  -1.65  -1.56     88   1.03
L[0,0,0]          1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan
L[0,1,0]         0.92  1.8e-3   0.01    0.9   0.91   0.92   0.93   0.94     46   1.09
L[0,2,0]         0.88  2.6e-3   0.02   0.84   0.86   0.87   0.89   0.91     46   1.09
L[0,3,0]         0.84  3.3e-3   0.02    0.8   0.82   0.84   0.85   0.88     46   1.09
L[0,0,1]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,1]         0.39  4.2e-3   0.03   0.34   0.38    0.4   0.41   0.44     44   1.09
L[0,2,1]         0.48  4.9e-3   0.03   0.41   0.46   0.48    0.5   0.54     44   1.09
L[0,3,1]         0.54  5.2e-3   0.03   0.47   0.52   0.55   0.57    0.6     45   1.09
L[0,0,2]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,2]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,2,2]         0.01  8.8e-5 8.4e-4   0.01   0.01   0.01   0.01   0.01     91    nan
L[0,3,2]         0.03  1.9e-4 1.8e-3   0.02   0.02   0.03   0.03   0.03     92   1.06
L[0,0,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,2,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,3,3]       2.4e-3  1.7e-5 1.7e-4 2.1e-3 2.3e-3 2.4e-3 2.5e-3 2.7e-3    102    nan
Theta[0]          1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan
L_sigma[0,0]     1.43  8.7e-3   0.07    1.3   1.38   1.42   1.47   1.59     67   1.06
L_sigma[0,1]     1.06  7.1e-3   0.05   0.97   1.03   1.06   1.09   1.17     52   1.11
L_sigma[0,2]     1.02  6.6e-3   0.05   0.93   0.99   1.02   1.05   1.13     54   1.11
L_sigma[0,3]      1.0  6.3e-3   0.05   0.91   0.97    1.0   1.03    1.1     57   1.11
mu_all[0,0]     -1.79    0.01   0.11  -2.03  -1.86  -1.79  -1.72  -1.59     97   1.03
mu_all[0,1]     -1.16  8.8e-3   0.08  -1.32  -1.21  -1.15   -1.1   -1.0     85   1.03
mu_all[0,2]     -1.35  8.4e-3   0.08  -1.52   -1.4  -1.35   -1.3  -1.21     86   1.03
mu_all[0,3]      -1.7  8.1e-3   0.08  -1.86  -1.75   -1.7  -1.65  -1.56     88   1.03
yrep[0,0]       -1.81    0.02   1.42  -4.59  -2.77  -1.79  -0.86   0.98   4000    1.0
yrep[1,0]       -1.82    0.02   1.43   -4.6  -2.75  -1.85  -0.86   1.07   4000    1.0
yrep[0,1]       -1.15    0.02   1.06  -3.22  -1.89  -1.14  -0.43   0.94   4000    1.0
yrep[1,1]       -1.18    0.02   1.06  -3.24  -1.87  -1.18  -0.49   0.95   3909    1.0
yrep[0,2]       -1.35    0.02   1.03  -3.31  -2.06  -1.34  -0.66   0.66   4000    1.0
yrep[1,2]       -1.37    0.02   1.02  -3.37  -2.04  -1.38  -0.71   0.67   3870    1.0
yrep[0,3]        -1.7    0.02    1.0  -3.63  -2.39  -1.69  -1.02    0.3   4000    1.0
yrep[1,3]       -1.72    0.02   0.99  -3.66  -2.37  -1.73  -1.07   0.28   3841    1.0
L_Sigma[0,0,0]   1.43  8.7e-3   0.07    1.3   1.38   1.42   1.47   1.59     67   1.06
L_Sigma[0,1,0]   0.98  8.0e-3   0.06   0.88   0.94   0.97   1.01   1.11     49   1.11
L_Sigma[0,2,0]    0.9  7.9e-3   0.06    0.8   0.86   0.89   0.93   1.02     49   1.11
L_Sigma[0,3,0]   0.84  7.8e-3   0.06   0.74    0.8   0.83   0.87   0.96     51    1.1
L_Sigma[0,0,1]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,1]   0.42  3.7e-3   0.02   0.37    0.4   0.42   0.43   0.46     41   1.09
L_Sigma[0,2,1]   0.49  4.3e-3   0.03   0.44   0.47   0.49   0.51   0.55     41   1.09
L_Sigma[0,3,1]   0.54  4.8e-3   0.03   0.48   0.52   0.54   0.56    0.6     41   1.09
L_Sigma[0,0,2]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,2]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,2,2]   0.01  5.0e-5 6.6e-4   0.01   0.01   0.01   0.01   0.01    173    nan
L_Sigma[0,3,2]   0.03  1.1e-4 1.4e-3   0.02   0.02   0.03   0.03   0.03    173   1.01
L_Sigma[0,0,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,2,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,3,3] 2.4e-3  5.6e-6 1.3e-4 2.1e-3 2.3e-3 2.4e-3 2.5e-3 2.6e-3    541    nan
lp__           846.55    0.18   2.73  840.2 844.97 846.93 848.49 850.88    219   1.02

Samples were drawn using NUTS at Fri Jul  7 14:06:49 2017.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at
convergence, Rhat=1).
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[154]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samples</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[155]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$100\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$250\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$350\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$500\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">n_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shade_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;yrep&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">df</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">n_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shade_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Blue&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/matplotlib/cbook.py:2649: UserWarning: Saw kwargs [&#39;c&#39;, &#39;color&#39;] which are all aliases for &#39;color&#39;.  Kept value from &#39;color&#39;
  seen=seen, canon=canonical, used=seen[-1]))
/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/matplotlib/axes/_axes.py:545: UserWarning: No labelled objects found. Use label=&#39;...&#39; kwarg on individual plots.
  warnings.warn(&#34;No labelled objects found. &#34;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[155]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;seaborn.axisgrid.PairGrid at 0x164c4f320&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_examples_.ipynb_checkpoints_Empirical_test-checkpoint_17_2.png" src="../../../_images/notebooks_examples_.ipynb_checkpoints_Empirical_test-checkpoint_17_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[156]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;yrep&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[156]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(array([   12.,    64.,   243.,   641.,   956.,  1044.,   675.,   275.,
           81.,     9.]),
 array([-6.70379782, -5.73487029, -4.76594277, -3.79701525, -2.82808773,
        -1.8591602 , -0.89023268,  0.07869484,  1.04762236,  2.01654988,
         2.98547741]),
 &lt;a list of 10 Patch objects&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_examples_.ipynb_checkpoints_Empirical_test-checkpoint_18_1.png" src="../../../_images/notebooks_examples_.ipynb_checkpoints_Empirical_test-checkpoint_18_1.png" />
</div>
</div>
</div>
<div class="section" id="Now-lets-do-the-same,-but-with-a-cut-at-of-0.1-\mathrm{m-Jy}">
<h2>Now lets do the same, but with a cut at of 0.1 <span class="math notranslate nohighlight">\(\mathrm{m Jy}\)</span><a class="headerlink" href="#Now-lets-do-the-same,-but-with-a-cut-at-of-0.1-\mathrm{m-Jy}" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[192]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ind</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S100&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span><span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S250&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S350&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S500&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/ipykernel/__main__.py:1: RuntimeWarning: divide by zero encountered in log10
  if __name__ == &#39;__main__&#39;:
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[193]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S100&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S250&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S350&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mock</span><span class="p">[</span><span class="s1">&#39;S500&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">])[</span><span class="n">ind</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/ipykernel/__main__.py:1: RuntimeWarning: divide by zero encountered in log10
  if __name__ == &#39;__main__&#39;:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[159]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="n">ind</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
      <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
      <span class="s1">&#39;n_groups&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[160]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">sampling</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[161]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[161]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference for Stan model: anon_model_e64f93d11b43efeb41e87e72a51be1f9.
4 chains, each with iter=2000; warmup=1000; thin=1;
post-warmup draws per chain=1000, total post-warmup draws=4000.

                 mean se_mean     sd   2.5%    25%    50%    75%  97.5%  n_eff   Rhat
mu_S250[0]      -0.04  7.2e-3   0.12  -0.26  -0.12  -0.04   0.04    0.2    253   1.01
mu_other[0,0]    0.18  5.9e-3   0.09   0.02   0.12   0.18   0.24   0.37    212   1.01
mu_other[0,1]   -0.09  5.8e-3   0.08  -0.25  -0.15  -0.09  -0.04   0.09    217   1.01
mu_other[0,2]   -0.49  5.7e-3   0.08  -0.65  -0.55  -0.49  -0.43  -0.31    222   1.01
L[0,0,0]          1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan
L[0,1,0]         0.88  2.6e-3   0.03   0.81   0.86   0.88    0.9   0.93    148   1.03
L[0,2,0]         0.83  3.8e-3   0.05   0.72    0.8   0.83   0.86    0.9    146   1.03
L[0,3,0]         0.79  4.6e-3   0.06   0.66   0.75   0.79   0.83   0.87    147   1.03
L[0,0,1]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,1]         0.47  4.8e-3   0.06   0.37   0.43   0.47   0.51   0.59    145   1.03
L[0,2,1]         0.56  5.5e-3   0.07   0.44   0.51   0.55    0.6   0.69    142   1.03
L[0,3,1]         0.61  5.8e-3   0.07   0.48   0.56   0.61   0.66   0.75    142   1.03
L[0,0,2]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,2]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,2,2]         0.03  2.6e-4 4.4e-3   0.02   0.02   0.03   0.03   0.04    292   1.03
L[0,3,2]         0.06  5.7e-4 9.8e-3   0.04   0.05   0.06   0.07   0.08    290   1.03
L[0,0,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,2,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,3,3]       4.2e-3  2.2e-5 6.3e-4 3.1e-3 3.7e-3 4.1e-3 4.5e-3 5.6e-3    851    nan
Theta[0]          1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan
L_sigma[0,0]     0.76  3.2e-3   0.07   0.64   0.71   0.76    0.8    0.9    430   1.01
L_sigma[0,1]     0.56  3.0e-3   0.05   0.47   0.53   0.56   0.59   0.65    232   1.02
L_sigma[0,2]     0.55  2.8e-3   0.04   0.47   0.52   0.55   0.58   0.64    248   1.02
L_sigma[0,3]     0.55  2.7e-3   0.04   0.47   0.52   0.54   0.58   0.64    268   1.02
mu_all[0,0]     -0.04  7.2e-3   0.12  -0.26  -0.12  -0.04   0.04    0.2    253   1.01
mu_all[0,1]      0.18  5.9e-3   0.09   0.02   0.12   0.18   0.24   0.37    212   1.01
mu_all[0,2]     -0.09  5.8e-3   0.08  -0.25  -0.15  -0.09  -0.04   0.09    217   1.01
mu_all[0,3]     -0.49  5.7e-3   0.08  -0.65  -0.55  -0.49  -0.43  -0.31    222   1.01
yrep[0,0]       -0.03    0.01   0.78  -1.55  -0.55  -0.02   0.48   1.53   3719    1.0
yrep[1,0]       -0.04    0.01   0.78  -1.58  -0.56  -0.04   0.47   1.43   3757    1.0
yrep[0,1]        0.19  9.5e-3   0.57  -0.92  -0.19   0.19   0.57    1.3   3645    1.0
yrep[1,1]        0.18    0.01   0.57  -0.95   -0.2   0.19   0.57   1.27   2334    1.0
yrep[0,2]       -0.08  9.3e-3   0.56  -1.18  -0.46  -0.08   0.29   1.02   3644    1.0
yrep[1,2]       -0.09    0.01   0.56  -1.19  -0.47  -0.08   0.29   0.98   2330    1.0
yrep[0,3]       -0.48  9.3e-3   0.56  -1.58  -0.86  -0.47  -0.11   0.62   3650    1.0
yrep[1,3]       -0.49    0.01   0.56  -1.59  -0.87  -0.47  -0.11   0.58   2345    1.0
L_Sigma[0,0,0]   0.76  3.2e-3   0.07   0.64   0.71   0.76    0.8    0.9    430   1.01
L_Sigma[0,1,0]   0.49  3.8e-3   0.05    0.4   0.46   0.49   0.53    0.6    185   1.02
L_Sigma[0,2,0]   0.45  4.0e-3   0.05   0.35   0.42   0.45   0.49   0.56    177   1.02
L_Sigma[0,3,0]   0.43  4.1e-3   0.05   0.32   0.39   0.43   0.47   0.54    175   1.02
L_Sigma[0,0,1]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,1]   0.26  2.0e-3   0.03   0.21   0.24   0.26   0.28   0.32    214   1.02
L_Sigma[0,2,1]    0.3  2.3e-3   0.03   0.25   0.28    0.3   0.33   0.37    212   1.02
L_Sigma[0,3,1]   0.33  2.5e-3   0.04   0.27   0.31   0.33   0.36   0.41    213   1.02
L_Sigma[0,0,2]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,2]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,2,2]   0.01  1.0e-4 2.0e-3   0.01   0.01   0.01   0.02   0.02    371   1.02
L_Sigma[0,3,2]   0.03  2.3e-4 4.5e-3   0.02   0.03   0.03   0.03   0.04    369   1.02
L_Sigma[0,0,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,2,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,3,3] 2.3e-3  7.3e-6 2.9e-4 1.8e-3 2.1e-3 2.2e-3 2.4e-3 2.9e-3   1608    nan
lp__           181.57    0.09   2.74 175.38  179.9 181.84 183.56 186.04    963    1.0

Samples were drawn using NUTS at Fri Jul  7 14:09:45 2017.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at
convergence, Rhat=1).
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[184]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samples</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$100\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$250\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$350\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$500\mathrm{\mu m}$ flux  (mJy)&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">n_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shade_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;yrep&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">,:],</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">df</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">n_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shade_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Blue&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">df</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;Green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greens&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">n_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shade_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Green&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[184]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;seaborn.axisgrid.PairGrid at 0x185323080&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_examples_.ipynb_checkpoints_Empirical_test-checkpoint_25_1.png" src="../../../_images/notebooks_examples_.ipynb_checkpoints_Empirical_test-checkpoint_25_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[201]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_cut</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">data {</span>
<span class="s2">  int N;</span>
<span class="s2">  int D;</span>
<span class="s2">  vector[D] y[N];</span>
<span class="s2">  int n_groups;</span>
<span class="s2">  real S1_cut;</span>
<span class="s2">}</span>
<span class="s2">parameters {</span>
<span class="s2">  ordered[n_groups] mu_1;</span>
<span class="s2">  vector[D-1] mu_other[n_groups];</span>
<span class="s2">  cholesky_factor_corr[D] L[n_groups];</span>
<span class="s2">  simplex[n_groups] Theta;</span>
<span class="s2">  vector&lt;lower=0&gt;[D] L_sigma[n_groups];</span>

<span class="s2">}</span>




<span class="s2">model {</span>
<span class="s2">  vector[n_groups] contributions;</span>
<span class="s2">  matrix[D, D] L_Sigma[n_groups];</span>
<span class="s2">  vector[D] mu_all[n_groups];</span>

<span class="s2">  // priors</span>
<span class="s2">  mu_1~normal(0, 10);</span>

<span class="s2">  Theta ~ dirichlet(rep_vector(2.0, n_groups));</span>
<span class="s2">  for(n in 1:n_groups) {</span>
<span class="s2">  y[n,1]~normal(mu_1[n],L_sigma[n,1])T[S1_cut,];</span>
<span class="s2">  mu_all[n,1]=mu_1[n];</span>
<span class="s2">  L[n] ~ lkj_corr_cholesky(4);</span>
<span class="s2">  L_sigma[n] ~ cauchy(0, 2.5);</span>
<span class="s2">  L_Sigma[n] = diag_pre_multiply(L_sigma[n], L[n]);</span>
<span class="s2">  for (i in 1:D-1){</span>
<span class="s2">  mu_other[n,i] ~ normal(0, 10);</span>
<span class="s2">  mu_all[n,d+1]=mu_other[n,d];</span>
<span class="s2">  }</span>
<span class="s2">  }</span>
<span class="s2">  // likelihood</span>
<span class="s2">  for(i in 1:N) {</span>
<span class="s2">    for(k in 1:n_groups) {</span>

<span class="s2">      contributions[k] = log(Theta[k]) + multi_normal_cholesky_lpdf(y[i] | mu_all[k], L_Sigma[k]);</span>
<span class="s2">    }</span>
<span class="s2">    target += log_sum_exp(contributions);</span>
<span class="s2">  }</span>
<span class="s2">}</span>
<span class="s2">generated quantities {</span>
<span class="s2">vector[D] yrep[2];</span>
<span class="s2">matrix[D, D] L_Sigma[n_groups];</span>
<span class="s2">vector[D] mu_all[n_groups];</span>
<span class="s2">for(n in 1:n_groups) {</span>
<span class="s2">mu_all[n,1]=mu_1[n];</span>
<span class="s2">for (i in 1:D-1){</span>
<span class="s2">mu_all[n,d+1]=mu_other[n,d];</span>
<span class="s2">}}</span>


<span class="s2">L_Sigma[1] = diag_pre_multiply(L_sigma[1], L[1]);</span>
<span class="s2">for(i in 1:2){</span>
<span class="s2">yrep[i]=multi_normal_cholesky_rng(mu_all[1], L_Sigma[1]);</span>
<span class="s2">}</span>


<span class="s2">}</span>


<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[202]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">pystan</span><span class="o">.</span><span class="n">StanModel</span><span class="p">(</span><span class="n">model_code</span><span class="o">=</span><span class="n">model_cut</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-202-3b8d96360199&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sm <span class="ansi-blue-fg">=</span> pystan<span class="ansi-blue-fg">.</span>StanModel<span class="ansi-blue-fg">(</span>model_code<span class="ansi-blue-fg">=</span>model_cut<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/pystan/model.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, file, charset, model_name, model_code, stanc_ret, boost_lib, eigen_lib, verbose, obfuscate_model_name, extra_compile_args)</span>
<span class="ansi-green-intense-fg ansi-bold">    209</span>                                          model_name<span class="ansi-blue-fg">=</span>model_name<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    210</span>                                          verbose<span class="ansi-blue-fg">=</span>verbose<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 211</span><span class="ansi-red-fg">                                          obfuscate_model_name=obfuscate_model_name)
</span><span class="ansi-green-intense-fg ansi-bold">    212</span>
<span class="ansi-green-intense-fg ansi-bold">    213</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>stanc_ret<span class="ansi-blue-fg">,</span> dict<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/Users/pdh21/anaconda3/envs/new/lib/python3.6/site-packages/pystan/api.py</span> in <span class="ansi-cyan-fg">stanc</span><span class="ansi-blue-fg">(file, charset, model_code, model_name, verbose, obfuscate_model_name)</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>     <span class="ansi-green-fg">if</span> result<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;status&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>  <span class="ansi-red-fg"># EXCEPTION_RC is -1</span>
<span class="ansi-green-intense-fg ansi-bold">    128</span>         error_msg <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;Failed to parse Stan model &#39;{}&#39;. Error message:\n{}&#34;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>model_name<span class="ansi-blue-fg">,</span> result<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;msg&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 129</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span>error_msg<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>     <span class="ansi-green-fg">elif</span> result<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;status&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>  <span class="ansi-red-fg"># SUCCESS_RC is 0</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span>         logger<span class="ansi-blue-fg">.</span>debug<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Successfully parsed Stan model &#39;{}&#39;.&#34;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>model_name<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">ValueError</span>: Failed to parse Stan model &#39;anon_model_bc04095b78d8e2d277080e335c6213d7&#39;. Error message:
SYNTAX ERROR, MESSAGE(S) FROM PARSER:


ERROR at line 24

 23:
 24:    }
        ^
 25:    model {

PARSER EXPECTED: &lt;model declaration (or perhaps an earlier block)&gt;

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[197]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="n">ind</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
      <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
      <span class="s1">&#39;n_groups&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;S1_cut&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[199]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">sampling</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[200]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[200]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference for Stan model: anon_model_e3bacdb8bc3576533de030cd989ba2dd.
4 chains, each with iter=2000; warmup=1000; thin=1;
post-warmup draws per chain=1000, total post-warmup draws=4000.

                 mean se_mean     sd   2.5%    25%    50%    75%  97.5%  n_eff   Rhat
mu_1[0]         -0.05  7.7e-3   0.12  -0.28  -0.13  -0.05   0.03   0.19    240    1.0
mu_other[0,0]    0.18  6.4e-3   0.09 6.9e-3   0.11   0.18   0.24   0.35    195    1.0
mu_other[0,1]   -0.09  6.2e-3   0.09  -0.26  -0.15  -0.09  -0.03   0.08    198    1.0
mu_other[0,2]   -0.49  6.2e-3   0.09  -0.66  -0.55  -0.49  -0.43  -0.32    202    1.0
L[0,0,0]          1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan
L[0,1,0]         0.88  2.4e-3   0.03    0.8   0.86   0.88    0.9   0.93    190   1.02
L[0,2,0]         0.82  3.5e-3   0.05   0.71   0.79   0.83   0.85    0.9    188   1.02
L[0,3,0]         0.78  4.2e-3   0.06   0.65   0.75   0.79   0.82   0.87    190   1.02
L[0,0,1]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,1]         0.48  4.3e-3   0.06   0.37   0.44   0.48   0.52    0.6    188   1.02
L[0,2,1]         0.57  4.8e-3   0.07   0.44   0.52   0.56   0.61    0.7    186   1.02
L[0,3,1]         0.62  5.0e-3   0.07   0.49   0.57   0.62   0.66   0.76    187   1.02
L[0,0,2]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,2]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,2,2]         0.03  2.4e-4 4.2e-3   0.02   0.02   0.03   0.03   0.04    315   1.02
L[0,3,2]         0.06  5.3e-4 9.3e-3   0.04   0.05   0.06   0.06   0.08    312   1.02
L[0,0,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,1,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,2,3]          0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L[0,3,3]       4.2e-3  2.7e-5 6.6e-4 3.1e-3 3.8e-3 4.1e-3 4.6e-3 5.7e-3    618    nan
Theta[0]          1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan
L_sigma[0,0]     0.76  3.8e-3   0.07   0.64   0.71   0.76    0.8    0.9    318   1.01
L_sigma[0,1]     0.56  3.3e-3   0.05   0.47   0.52   0.55   0.59   0.66    210   1.02
L_sigma[0,2]     0.55  3.1e-3   0.05   0.46   0.52   0.55   0.58   0.65    220   1.02
L_sigma[0,3]     0.55  3.1e-3   0.05   0.46   0.51   0.54   0.58   0.65    230   1.02
mu_all[0,0]     -0.05  7.7e-3   0.12  -0.28  -0.13  -0.05   0.03   0.19    240    1.0
mu_all[0,1]      0.18  6.4e-3   0.09 6.9e-3   0.11   0.18   0.24   0.35    195    1.0
mu_all[0,2]     -0.09  6.2e-3   0.09  -0.26  -0.15  -0.09  -0.03   0.08    198    1.0
mu_all[0,3]     -0.49  6.2e-3   0.09  -0.66  -0.55  -0.49  -0.43  -0.32    202    1.0
yrep[0,0]       -0.05    0.01   0.76  -1.56  -0.54  -0.04   0.45   1.41   2831    1.0
yrep[1,0]       -0.04    0.01   0.77  -1.57  -0.55  -0.05   0.47   1.52   3264    1.0
yrep[0,1]        0.18    0.01   0.56  -0.92  -0.21   0.19   0.56   1.26   2933    1.0
yrep[1,1]        0.19  9.7e-3   0.57   -0.9  -0.19   0.18   0.56   1.31   3435    1.0
yrep[0,2]       -0.09    0.01   0.55  -1.16  -0.47  -0.08   0.27   0.98   2977    1.0
yrep[1,2]       -0.08  9.5e-3   0.56  -1.15  -0.45  -0.09   0.28   1.02   3452    1.0
yrep[0,3]       -0.49    0.01   0.55  -1.57  -0.86  -0.48  -0.12   0.58   3009    1.0
yrep[1,3]       -0.48  9.5e-3   0.56  -1.55  -0.85  -0.48  -0.12   0.61   3473    1.0
L_Sigma[0,0,0]   0.76  3.8e-3   0.07   0.64   0.71   0.76    0.8    0.9    318   1.01
L_Sigma[0,1,0]   0.49  3.7e-3   0.05   0.39   0.45   0.49   0.52    0.6    195   1.02
L_Sigma[0,2,0]   0.45  3.9e-3   0.05   0.35   0.41   0.45   0.48   0.57    195   1.02
L_Sigma[0,3,0]   0.43  4.0e-3   0.06   0.32   0.39   0.43   0.46   0.55    198   1.02
L_Sigma[0,0,1]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,1]   0.26  2.0e-3   0.03   0.21   0.24   0.26   0.28   0.33    221   1.02
L_Sigma[0,2,1]   0.31  2.4e-3   0.03   0.25   0.28   0.31   0.33   0.38    218   1.02
L_Sigma[0,3,1]   0.34  2.6e-3   0.04   0.27   0.31   0.33   0.36   0.42    216   1.02
L_Sigma[0,0,2]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,2]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,2,2]   0.01  8.7e-5 1.9e-3   0.01   0.01   0.01   0.02   0.02    481   1.02
L_Sigma[0,3,2]   0.03  2.5e-4 4.3e-3   0.02   0.03   0.03   0.03   0.04    285   1.02
L_Sigma[0,0,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,1,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,2,3]    0.0     0.0    0.0    0.0    0.0    0.0    0.0    0.0   4000    nan
L_Sigma[0,3,3] 2.3e-3  7.2e-6 3.0e-4 1.8e-3 2.1e-3 2.3e-3 2.5e-3 3.0e-3   1689    nan
lp__           181.55    0.11   2.81 174.97 179.94 181.95 183.61  185.9    691    1.0

Samples were drawn using NUTS at Fri Jul  7 15:56:11 2017.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at
convergence, Rhat=1).
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Peter Hurley

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>